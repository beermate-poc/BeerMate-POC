"use strict";var WPCL=WPCL||{};WPCL.Library=function(){this.instanceId=null,this.options={iframeHelperURL:"",url:"https://payments.worldpay.com/",type:"lightbox",inject:"default",target:null,trigger:null,lightboxMaskOpacity:50,lightboxMaskColor:"#000000",lightboxShadowColor:"#666",lightboxShadowSize:"30px",accessibility:!1,language:"en",country:"",preferredPaymentMethod:"",disableScrolling:!1,hideContent:!1,checkoutURL:null,successURL:"",cancelURL:"",failureURL:"",pendingURL:"",errorURL:"",resultCallback:null,flowCallback:null,customisation:null,debug:!1},this.iframeTitlesLanguageMap={bg:"ĐĄŃŃĐ°Đ˝Đ¸ŃĐ¸ ĐˇĐ° ĐżĐťĐ°ŃĐ°Đ˝Đľ",bs:"Stranice za plaÄanje",ca:"PĂ gines de pagament",cs:"PlatebnĂ­ strĂĄnky",cy:"Tudalennau talu",da:"Betalingssider",de:"Zahlungsseiten",el:"ÎŁÎľÎťÎŻÎ´ÎľĎ ĎÎťÎˇĎĎÎźÎŽĎ",en:"Payment Pages",es:"PĂĄginas de pago",et:"Makse lehekĂźljed",fi:"Maksusivut",fr:"Pages de paiement",hi:"ŕ¤­ŕĽŕ¤ŕ¤¤ŕ¤žŕ¤¨ ŕ¤ŞŕĽŕ¤",hr:"Stranice za plaÄanje",hu:"FizetĂŠsi oldalak",it:"Pagine di pagamento",ja:"ćąşć¸ăăźă¸",ko:"ę˛°ě  íě´ě§",lv:"MaksÄjumu lapas",nl:"Betaalpaginaâs",no:"Betalingssider",pl:"Strony pĹatnoĹci",pt:"PĂĄginas do pagamento",ro:"Pagini de platÄ",ru:"ĐĄŃŃĐ°Đ˝Đ¸ŃŃ ĐžĐżĐťĐ°ŃŃ",si:"ŕśŕˇŕˇŕˇŕś¸ŕˇ ŕś´ŕˇŕś§ŕˇ",sk:"WebovĂŠ strĂĄnky na vykonĂĄvanie platieb",sl:"PlaÄilne strani",sv:"Betalningssidor",tr:"Ădeme SayfalarÄą",zh:"ćŻäťéĄľé˘",th:"ŕ¸Ťŕ¸ŕšŕ¸˛ŕ¸ŕ¸łŕ¸Łŕ¸°ŕšŕ¸ŕ¸´ŕ¸",zh_TW:"ćŻäťé é˘",es_CO:"PĂĄginas de pago",pt_BR:"PĂĄginas de pagamento"},this.lightboxMaxWidth=750,this.prefix="wp-cl",this.wpName=this.prefix,this.isPostMessage=!1,this.sdkInfoAlreadySent=!1,this.isFakeLoadEvent=!1,this.onloadInject=null,this.postMessageHandler=null},WPCL.Library.prototype=function(){function t(){var e=this,t=document.getElementById(e.prefix),n=document.getElementById(e.options.trigger);x.call(e,"Destroying lightbox..."),t&&t.parentNode&&t.parentNode.removeChild(t),e.options.accessibility&&(function(){var e=["a","input","select"];x.call(self,"Removing accessibility changes...");for(var t=0;t<e.length;t++)for(var n=document.getElementsByTagName(e[t]),i=0;i<n.length;i++)n[i].removeAttribute("tabindex")}.call(e),n&&n.focus&&n.focus())}function n(e,t){var n=this,i=R.call(n);if(null!=i)if(t||!n.isPostMessage){if(n.options.hideContent)x.call(n,"WARN: skipped resizing iframe as hideContent is enabled");else if(i.style.height=parseInt(e)+"px",x.call(n,"iframe resized - height: "+e),"lightbox"===n.options.type){var a=document.body,o=document.documentElement;Math.max(a.scrollHeight,a.offsetHeight,o.clientHeight,o.scrollHeight,o.offsetHeight)<e&&(document.body.style.height=parseInt(e)+"px",x.call(n,"lightbox container resized - height: "+e))}}else x.call(n,"WARN: iframe not found for height resize");else x.call(n,"WARN: iframe not found for height resize")}var i=function(){var e=this,t=l(e.options.url);u(e.options.iframeHelperURL)&&x.call(e,"ERROR: iframe helper url is missing"),t=t.replace("/hpp/","/hpp-iframe/"),t=s(t,"iframeIntegrationId",e.instanceId);var n=a.call(e);if(null!=n&&(t=s(t,"checkoutURL",n)),null!=e.options.flowCallback){var i=o.call(e);t=s(t,"iframeOrigin",i)}return t=s(t,"iframeHelperURL",e.options.iframeHelperURL),t=s(t,"language",e.options.language),t=s(t,"country",e.options.country),t=s(t,"preferredPaymentMethod",e.options.preferredPaymentMethod),t=s(t,"successURL",e.options.successURL),t=s(t,"cancelURL",e.options.cancelURL),t=s(t,"failureURL",e.options.failureURL),t=s(t,"pendingURL",e.options.pendingURL),t=s(t,"errorURL",e.options.errorURL),x.call(e,"url set to: "+t),t},a=function(){var e=this.options.checkoutURL;return null!=e?0==(e=e.trim()).length&&(e=null):e=window.location.href,e},o=function(){return location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")},u=function(e){return!e||0===e.length},l=function(e){return u(e)?e:e.replace(/&amp;/g,"&")},s=function(e,t,n){if(u(n)||u(t))return e;var i=new RegExp("[?&]"+t+"=");if(-1===e.search(i))return e+"&"+t+"="+encodeURIComponent(n);var a=new RegExp("[?&]"+t+"=[^&]");return-1===e.search(a)?e.replace(i,""):e},r=function(e){var t=this;for(var n in e)t.options.hasOwnProperty(n)&&(t.options[n]=e[n]);t.wpName+="-",t.wpName+=t.options.target,x.call(t,"Overriding options with the following:"),x.call(t,JSON.stringify(t.options))},c=function(){x.call(this,"Setting up iframe..."),L.call(this),e.call(this)},e=function(){var t=this,e=document.getElementById(t.options.target);x.call(t,"Injecting iframe into page..."),null!=e?(t.onloadInject=function(){d.call(t)},"immediate"===t.options.inject?d.call(t):"onload"===t.options.inject?window.addEventListener?(x.call(t,"The browser supports addEventListener"),window.addEventListener("load",t.onloadInject,!1)):window.attachEvent?(x.call(t,"The  browser supports attachEvent"),window.attachEvent("onload",t.onloadInject)):x.call(t,"ERROR: the  browser does not support an onload event-handler"):"default"===t.options.inject?window.onload=function(e){d.call(t),e&&e.target&&e.target!=document&&(t.isFakeLoadEvent=!0)}:x.call(t,"ERROR: accepted parameters are immediate, onload, default")):x.call(t,"ERROR: HTML target, specified by 'target' parameter, could not be found - target: "+t.options.target)},d=function(){var e=document.createElement("div");e.id=this.prefix,m.call(this,e),b.call(this,e),v.call(this)},p=function(){var e=this,t=!0;x.call(e,"Setting up lightbox..."),k(e.options.lightboxMaskOpacity)&&(x.call(e,"ERROR: parameter 'lightboxMaskOpacity' is NaN: "+e.options.lightboxMaskOpacity),t=!1),t&&(L.call(e),g.call(e))},g=function(){var e=this,t=document.getElementById(e.options.trigger);x.call(e,"Binding lightbox..."),null!=t?(t.onclick=function(){return h.call(e),!1},x.call(e,"Binded lightbox")):x.call(e,"ERROR: lightbox trigger (element) could not be found - trigger: "+e.options.trigger)},h=function(){var e=this,t=document.getElementById(e.options.target);if(x.call(e,"Injecting lightbox..."),null!=t){var n=document.createElement("div");n.id=e.prefix;var i=document.createElement("div");i.id=e.prefix+"-mask",i.setAttribute("style","position: fixed;top:0;left:0;background: "+e.options.lightboxMaskColor+';width: 100%;height: 100%;-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity='+e.options.lightboxMaskOpacity+')";filter: alpha(opacity='+e.options.lightboxMaskOpacity+");opacity: "+e.options.lightboxMaskOpacity/100+";z-index: 100005;-webkit-transform: translate3d(0,0,0);"),n.appendChild(i);var a=document.createElement("div");a.id=e.prefix+"-content",a.setAttribute("style","position:fixed;top:0;left:0;bottom:0;right:0;width:100%;z-index:100006;padding:16px;box-sizing:border-box;"),n.appendChild(a);var o=document.createElement("div");o.id=e.prefix+"-lightbox",o.setAttribute("role","dialog"),o.setAttribute("style","top:60px;z-index: 100006;margin: 0 auto;max-width:"+e.lightboxMaxWidth+"px;"),a.appendChild(o);var l=document.createElement("div");l.id=e.wpName,o.appendChild(l),m.call(e,l),b.call(e,n),e.options.accessibility&&y.call(e),E.call(e,0),f.call(e),v.call(e)}else x.call(e,"ERROR: HTML target, specified by 'target' parameter, could not be found - target: "+e.options.target)},f=function(){var e=document.getElementById(this.wpName+"-iframe");null!=e&&document.activeElement!=e&&window.setTimeout(function(){e.focus()},0)},m=function(e){var t=this,n=t.options.customisation,i="iframe"==t.options.type,a="lightbox"==t.options.type,o=null!=n,l=function(){var e=this,t={language:e.options.language,title:e.iframeTitlesLanguageMap[e.options.language]};return(u(t.language)||u(t.title))&&(t.language="en",t.title=e.iframeTitlesLanguageMap.en,x.call(e,"WARN: language '"+e.options.language+"'not found for parameter 'language', using default instead...")),t}.call(t),s=t.options.hideContent,r=document.createElement("iframe");r.id=t.wpName+"-iframe",r.name=t.wpName+"-iframe",r.title=l.title,o||(r.src=t.options.iframeUrl),r.setAttribute("class","wp-cl-iframe"),r.setAttribute("allowtransparency","yes"),r.setAttribute("scrolling","no"),r.setAttribute("frameBorder","0"),r.setAttribute("border","0"),r.setAttribute("allow","payment"),r.setAttribute("allowpaymentrequest","");try{r.allowPaymentRequest=!0}catch(e){x.call(t,"WARN: failed to allow payment request: "+e)}var c=i&&s?0:400;if(r.setAttribute("style","width: 1px;min-width: 100%;*width: 100%;border:0;background: transparent;height:"+c+"px;"+(i&&s?"display: block; visibility:hidden;":"")+(a?"border-radius:6px;overflow:hidden;box-shadow:0 0 "+t.options.lightboxShadowSize+" "+t.options.lightboxShadowColor+";":"")),e.appendChild(r),o){n=JSON.stringify(t.options.customisation);var d=document.createElement("form");d.id=t.wpName+"-iframe-form",d.method="POST",d.action=t.options.iframeUrl,d.target=t.wpName+"-iframe";var p=document.createElement("input");p.type="hidden",p.name="customisation",p.value=n,d.appendChild(p),e.appendChild(d)}return e},b=function(e){var t=document.getElementById(this.options.target);if(null!=t){if(0<t.childNodes.length)for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(e)}else x.call(this,"ERROR: HTML target, specified by 'target' parameter, could not be found - target: "+this.options.target)},v=function(){var e=document.getElementById(this.wpName+"-iframe-form");null!=e&&e.submit()},y=function(){var e=["a","input","select"],t=document.getElementById(this.options.target);x.call(this,"Setting accessibility features");for(var n=0;n<e.length;n++)for(var i=document.getElementsByTagName(e[n]),a=0;a<i.length;a++)i[a].tabIndex=-1;for(var o=0;o<e.length;o++)for(var l=t.getElementsByTagName(e[o]),s=0;s<l.length;s++)l[s].removeAttribute("tabindex")},w=function(){null!=this.postMessageHandler&&(window.removeEventListener?window.removeEventListener("message",this.postMessageHandler):window.detachEvent("onmessage",this.postMessageHandler),x.call(self,"INFO: destroyed post message event listener"))},R=function(){var e=this.wpName+"-iframe",t=document.getElementById(e);return null==t&&x.call(this,"WARN - unable to find iframe - target name: "+e),t},k=function(e){return"string"==typeof e||isNaN(e)},x=function(e){this&&this.options&&this.options.debug&&console&&console.log&&console.log("Worldpay HPP JavaScript SDK - "+e)},E=function(e){var t=this.options.type;if(!this.options.disableScrolling&&"iframe"===t){var n=R.call(this).getBoundingClientRect().top,i=window.pageYOffset+n;null!=e&&(i+=e),document.body.scrollTop=i,document.documentElement.scrollTop=i,x.call(this,"changed vertical scroll position: "+i)}},L=function(){var t=this;w.call(t),this.postMessageHandler=function(e){M.call(t,e)},window.addEventListener?window.addEventListener("message",this.postMessageHandler,!1):window.attachEvent("onmessage",this.postMessageHandler)},M=function(e){var t=this;this.isPostMessage=!0;var n=e.origin||e.originalEvent.origin,i=t.options.url;if(null==i||0==i.indexOf(n)||(x.call(t,"WARN - post-message from different source - origin: "+n+", ticketUrl: "+i),t.options.debug)){var a;try{a=JSON.parse(e.data)}catch(e){a=null}if(null!=a&&"hpp"==a.source&&null!=a.action&&null!=a.args)if(null!=a.id&&0<a.id.length&&a.id!=t.instanceId)x.call(t,"ignoring message as different instance - req: "+a.id+", ours: "+t.instanceId);else switch(a.action){case"check":C.call(t);break;case"resize":N.call(t,a);break;case"scroll":O.call(t,a);break;case"result":I.call(t,a);break;case"flow":S.call(t,a);break;default:x.call(t,"unhandled action: "+a.action)}else x.call(t,"malformed post-message received - "+JSON.stringify(a))}},C=function(){x.call(this,"received postMessage mechanism check, replying back");var e={source:"hpp",action:"check-working",sdkInfo:U.call(this)};H.call(this,e)},N=function(e){var t=e.args.height;x.call(this,"resizing iframe... - height: "+t),n.call(this,t,!0)},O=function(e){var t=e.args.scrollingOffset;x.call(this,"scrolling payments page..."),E.call(this,t)},I=function(e){P.call(this,"result",this.options.resultCallback,e.args.result)},S=function(e){P.call(this,"flow",this.options.flowCallback,e.args)},P=function(e,t,n){null==t?x.call(self,"no "+e+" callback function specified, skipping "+e+" callback invocation"):null==n?x.call(self,"null "+e+" result from payment pages, skipping "+e+" callback invocation"):(x.call(self,"invoking "+e+" callback"),t(n))},U=function(){var e,t=this;if(t.sdkInfoAlreadySent)e={alreadySent:"true"};else{var n=T.call(t),i=t.options.type,a=A.call(t),o=j.call(t),l=B.call(t),s=null!=t.options.resultCallback,r=null!=t.options.flowCallback,c=t.options.inject,d=null!=t.options.customisation;e={version:"18.0",saved:n,integrationType:i,insideFrame:a,parentCrossDomain:o,manualOnload:l,debug:t.options.debug,resultCallback:s,flowCallback:r,inject:c,customisation:d,disableScrolling:t.options.disableScrolling,hideContent:t.options.hideContent},t.sdkInfoAlreadySent=!0}return e},A=function(){try{return top!=window}catch(e){return!0}},j=function(){try{return!(null!=parent&&parent.document)}catch(e){return!0}},B=function(){var e=!1;return"iframe"==this.options.type&&(e=this.isFakeLoadEvent),e},T=function(){for(var e,t=!0,n=document.getElementsByTagName("script"),i=0;t&&i<n.length;i++)null!=(e=n[i].src)&&0<e.indexOf(".worldpay")&&(t=!1);return t},H=function(e){var t=JSON.stringify(e),n=R.call(this);if(null!=n&&n.contentWindow&&n.contentWindow.postMessage){var i=W.call(this);n.contentWindow.postMessage(t,i)}else x.call(this,"unable to send message to payment pages, iframe not available - has it been injected on your page?")},W=function(){var e=this.options.url,t=e.indexOf("/",10);return e.substring(0,t)};return{setup:function(e){var t=this;switch(x.call(t,"Setting up library..."),this.instanceId=(new Date).getTime()+Math.floor(100*Math.random()),r.call(t,e),t.options.iframeUrl=i.call(t),t.options.type){case"iframe":c.call(t);break;case"lightbox":p.call(t);break;default:x.call(t,"ERROR: parameter 'type' is not a valid value")}},destroy:function(){var e=this;"iframe"===e.options.type?function(){var e=this;document.getElementById(e.options.target).innerHTML="","onload"===e.options.inject&&(window.removeEventListener?window.removeEventListener("load",e.onloadInject,!1):window.attachEvent?window.detachEvent("onload",e.onloadInject):x.call(e,"ERROR: the  browser does not support an onload event-handler"))}.call(e):"lightbox"===e.options.type?t.call(e):x.call(e,"WARN: injected content not cleaned up"),w.call(e)},resize:n,redirect:function(e){window.location.replace(e)},scroll:E,populateForm:function(e){var t=this;if(null==e)x.call(t,"unable to populate fields on payment pages, null or empty object provided");else if(e.constructor&&e.constructor===Object){var n=!0;for(var i in e){var a=e[i];null==a||a.constructor&&(a.constructor===String||a.constructor===Number)||(x.call(t,"unable to populate fields on payment pages, property '"+i+"' must be a string"),n=!1)}if(n){x.call(t,"populating fields on payment pages...");var o={source:"hpp",action:"populate-form",data:e};H.call(t,o)}}else x.call(t,"unable to populate fields on payment pages, argument must be a JSON object")},submitForm:function(){x.call(this,"submitting form on payment pages...");H.call(this,{source:"hpp",action:"submit-form"})}}}();
//# sourceMappingURL=hpp-embedded-integration-library.js.map